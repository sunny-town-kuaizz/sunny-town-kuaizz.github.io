<?php

/**
 * 邮件提醒相关函数
 */
if(!defined('THEME_NAME')) die('非法访问 - Insufficient Permissions');

// 评论回应邮件通知
function mk_comment_mail_notify($comment_id) {
    $admin_email          = get_option('admin_email');
    $comment              = get_comment($comment_id);
    $comment_author_email = trim($comment->comment_author_email);
    $parent_id            = $comment->comment_parent ? $comment->comment_parent : '';
    $to                   = $parent_id ? trim(get_comment($parent_id)->comment_author_email) : '';
    $spam_confirmed       = $comment->comment_approved;
    
    // 被评论者没留邮箱或评论内容未通过审核不发邮件
    if(!$to || !$parent_id) return;
    if($spam_confirmed == 'spam') return;
    
    // 可视个人要求修改以下的两个邮件发送条件：
    if($to == $admin_email) return;                     // 被评论者是管理员，不发邮件
    if($comment_author_email != $admin_email) return;   // 非管理员给出的回复不发邮件给被评论者
    
    
    /*****************************************************/
    $blog_url   = get_option('home');
    $blog_name  = get_option('blogname');
    $subject    = '您在 [' . $blog_name . '] 的留言有了新回复';
    $headers    = mk_mail_headers();
    
    $message = mk_mail_templet(
        $blog_name, 
        $blog_url, 
        '@' . trim(get_comment($parent_id)->comment_author) . '，您曾在《' . get_the_title($comment->comment_post_ID) . '》中发表吐槽：', 
        trim(mk_comment_code_escape(get_comment($parent_id)->comment_content)), 
        trim($comment->comment_author), 
        trim(mk_comment_code_escape($comment->comment_content)), 
        htmlspecialchars(get_comment_link($parent_id, array('type' => 'comment')))
    );
    
    wp_mail($to, $subject, $message, $headers);
}
add_action('comment_post', 'mk_comment_mail_notify');


// 接收回复邮件通知的按钮（仅供装饰，无实际作用）
function mk_comment_checkbox() {
    echo '
    <span class="comment-mail-notify">
        <label class="mk-checkbox">
            <input type="checkbox" checked>
            <div><div></div></div> 
            接收回复邮件通知
        </label>
    </span>';
}
add_action('comment_form', 'mk_comment_checkbox');


// 后台发送测试邮件
function mk_mail_test() {
    $blog_url   = get_option('home');
    $blog_name  = get_option('blogname');
    $to         = get_option('admin_email');
    $subject    = '[' . $blog_name . '] 测试邮件';
    $headers    = mk_mail_headers();
    
    $message    = mk_mail_templet(
        $blog_name, 
        $blog_url, 
        '您正在后台测试邮件自动发送功能', 
        '如果您收到这封邮件，说明您的博客已经能正常发邮件了！'
    );
    
    wp_mail($to, $subject, $message, $headers);
    
    die('邮件已发送至您的邮箱（'. $to .'），如果您没有收到邮件，仔细检查表单选项是否填写正确，服务器是否已开放相关端口！');
}
add_action('wp_ajax_mail_test', 'mk_mail_test');


// 博客后台登录失败时发送邮件通知管理员
function mk_login_failed_notify() {
    if(defined('MK_NO_FAILED_EMAIL')) {
        return;
    }
    
    date_default_timezone_set('PRC');
    
    $user_name  = $_POST['log'];
    $password   = $_POST['pwd'];
    
    if($user_name === $password) return;    // 不会有人账号密码用同一个吧……
    
    $blog_url   = get_option('home');
    $blog_name  = get_option('blogname');
    $to         = get_option('admin_email');
    $subject    = '[' . $blog_name . '] 安全通知：后台登录失败提醒';
    $headers    = mk_mail_headers();
    
    $message    = mk_mail_templet(
        $blog_name, 
        $blog_url, 
        '<span style="color: #ff5722;">『' . $blog_name . '』有一条登录失败的记录产生，若该登录操作不是您产生的，请注意加强网站安全防护！</span>', 
        '登录名：' . htmlspecialchars($user_name)
        .'<br>尝试密码：' . htmlspecialchars($password)
        .'<br>登录时间：' . date('Y-m-d H:i:s')
        .'<br>IP 地址：' . $_SERVER['REMOTE_ADDR']
    );
    
    wp_mail($to, $subject, $message, $headers);
}
add_action('wp_login_failed', 'mk_login_failed_notify');


// 美化管理员的邮件
function mk_admin_email($notify_message, $comment_id) {
    $blog_url   = get_option('home'); 
    $blog_name  = get_option('blogname');
    $notify_message = str_replace("\n", '<br>', $notify_message);
    
    return mk_mail_templet($blog_name, $blog_url, $notify_message);
}
add_filter('comment_notification_text', 'mk_admin_email', 10, 2);     // 文章/评论被评论/回复时提醒发表者
add_filter('comment_moderation_text',   'mk_admin_email', 10, 2);     // 新评论通知审核者


// 管理员邮件支持 HTML 格式
function mk_admin_email_headers($message_headers, $comment_id) {
    if(!$message_headers) {
        return mk_mail_headers();
    }
    return str_replace('Content-Type: text/plain;', 'Content-Type: text/html;', $message_headers);
}
add_filter('comment_notification_headers', 'mk_admin_email_headers', 10, 2);
add_filter('comment_moderation_headers',   'mk_admin_email_headers', 10, 2);


// 获取邮件头
function mk_mail_headers($reply_to = '') {
    $blogname = wp_specialchars_decode(get_option('blogname'), ENT_QUOTES);
	$wp_email = 'no-reply@' . preg_replace('#^www\.#', '', strtolower( $_SERVER['SERVER_NAME']));
    $from     = "From: \"$blogname\" <$wp_email>";
    
	$message_headers = "$from\n"
	. 'Content-Type: text/html; charset="' . get_option('blog_charset') . "\"\n";
    
    if ($reply_to) {
		$message_headers .= "Reply-To: \"$reply_to\" <$reply_to>" . "\n";
	}
    
    return $message_headers;
}


// 孟坤邮件美化模板生成函数
function mk_mail_templet($blog_name, $blog_url, $line_1, $line_2 = '', $line_3='', $line_4='', $detal_url='') {
    $content = '
        <style> img[src="javascript:;"] { display: none; } </style>
        <div style="position: relative; color:#555;font:12px/1.5 Microsoft YaHei,Tahoma,Helvetica,Arial,sans-serif;max-width:600px;margin:50px auto;border-radius: 5px;box-shadow:0 5px 10px #aaaaaa;background: 0 0 repeat-x #FFF;background-image: -webkit-repeating-linear-gradient(135deg, #4882CE, #4882CE 20px, #FFF 20px, #FFF 35px, #EB1B2E 35px, #EB1B2E 55px, #FFF 55px, #FFF 70px);background-image: repeating-linear-gradient(-45deg, #4882CE, #4882CE 20px, #FFF 20px, #FFF 35px, #EB1B2E 35px, #EB1B2E 55px, #FFF 55px, #FFF 70px);background-size: 100% 10px; mkblog-email: true;">
        <img style="position: absolute; right: 15px;top: 20px;width:133px;height: 87px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIUAAABXCAMAAAAd8nYqAAADAFBMVEUAAADW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1taqJyaLAAAA/3RSTlMAAQIDBAUGBwgJCgsMDQ4PEBESExQVFhcYGRobHB0eHyAhIiMkJSYnKCkqKywtLi8wMTIzNDU2Nzg5Ojs8PT4/QEFCQ0RFRkdISUpLTE1O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">
        <div style="padding: 0 15px 8px;">
            <h2 style="border-bottom:1px solid #e9e9e9;font-size:18px;font-weight:normal;padding:20px 0 10px;">
                <span style="color: #12ADDB">&gt; </span>';
    
    if($line_3) {
                $content .= '
                您在 
                <a style="text-decoration:none;color: #12ADDB;" href="' . $blog_url . '" title="' . $blog_name . '" target="_blank">
                    ' . $blog_name . '
                </a>
                中的吐槽收到新回复啦！';
    } else {
                $content .= '
                来自 
                <a style="text-decoration:none;color: #12ADDB;" href="' . $blog_url . '" title="' . $blog_name . '" target="_blank">
                    ' . $blog_name . '
                </a>
                的通知邮件';
    }
    
    $content .= '
            </h2>
            <div style="font-size:14px;color:#777;padding:0 10px;margin-top:18px">
                <p>' . $line_1 . '</p>';
                
    if($line_2) 
                $content .= '
                <p style="background-color: #f5f5f5;padding: 10px 15px;margin:18px 0">
                    '. $line_2 . '
                </p>';
    
    if($line_3) {
                $content .= '
                <p>' . $line_3 . ' 回复说:</p>
                <p style="background-color:#f5f5f5;padding: 10px 15px;margin:18px 0">
                    '. $line_4 . '
                </p>
                <p>
                    您可以点击 
                    <a style="text-decoration:none; color:#12addb" href="' . $detal_url . '" title="点击查看完整的回复内容" target="_blank">
                        查看完整的回复内容
                    </a>，欢迎再次光临 
                    <a style="text-decoration:none; color:#12addb" href="' . $blog_url . '" title="' . $blog_name . '" target="_blank">' . $blog_name . '</a>！
                </p>';
    }
        
    $content .= '
            </div>
        </div>
        <div style="color:#888;padding:10px;border-top:1px solid #e9e9e9;background:#f5f5f5;border-radius: 0 0 5px 5px;">
            <p style="margin:0;padding:0;">
                Copyright © 
                <span style="border-bottom-width: 1px; border-bottom-style: dashed; border-bottom-color: rgb(204, 204, 204); z-index: 1; position: static;"
                  t="7" data="2011-'.date('Y').'">2011-'.date('Y').'</span>  
                <a style="color:#888;text-decoration:none;" href="' . $blog_url . '" title="' . $blog_name . '" target="_blank">' . $blog_name . '</a>
                - 邮件自动生成，请勿直接回复！
            </p>
        </div>
        </div>';
    
    return $content;
}


?>