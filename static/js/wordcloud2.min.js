"use strict";window.setImmediate||(window.setImmediate=function(){return window.msSetImmediate||window.webkitSetImmediate||window.mozSetImmediate||window.oSetImmediate||function(){var a,b,c;return window.postMessage&&window.addEventListener?(a=[void 0],b="zero-timeout-message",c=function(c){var d=a.length;return a.push(c),window.postMessage(b+d.toString(36),"*"),d},window.addEventListener("message",function(c){if("string"==typeof c.data&&c.data.substr(0,b.length)===b){c.stopImmediatePropagation();var d=parseInt(c.data.substr(b.length),36);a[d]&&(a[d](),a[d]=void 0)}},!0),window.clearImmediate=function(b){a[b]&&(a[b]=void 0)},c):null}()||function(a){window.setTimeout(a,0)}}()),window.clearImmediate||(window.clearImmediate=function(){return window.msClearImmediate||window.webkitClearImmediate||window.mozClearImmediate||window.oClearImmediate||function(a){window.clearTimeout(a)}}()),function(a){var b=function(){var b,a=document.createElement("canvas");return a&&a.getContext?(b=a.getContext("2d"),b?b.getImageData?b.fillText?Array.prototype.some?Array.prototype.push?!0:!1:!1:!1:!1:!1):!1}(),c=function(){var a,c,d,e;if(b){for(a=document.createElement("canvas").getContext("2d"),c=20;c;){if(a.font=c.toString(10)+"px sans-serif",a.measureText("Ｗ").width===d&&a.measureText("m").width===e)return c+1;d=a.measureText("Ｗ").width,e=a.measureText("m").width,c--}return 0}}(),d=function(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a},e=function(a,e){function u(a,b){return"hsl("+(360*Math.random()).toFixed()+","+(30*Math.random()+70).toFixed()+"%,"+(Math.random()*(b-a)+a).toFixed()+"%)"}var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O;if(b){if(Array.isArray(a)||(a=[a]),a.forEach(function(b,c){if("string"==typeof b){if(a[c]=document.getElementById(b),!a[c])throw"The element id specified is not found."}else if(!b.tagName&&!b.appendChild)throw"You must pass valid HTML elements, or ID of the element."}),f={list:[],fontFamily:'"Trebuchet MS", "Heiti TC", "微軟正黑體", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',fontWeight:"normal",color:"random-dark",minSize:0,weightFactor:1,clearCanvas:!0,backgroundColor:"#fff",gridSize:8,drawOutOfBound:!1,shrinkToFit:!1,origin:null,drawMask:!1,maskColor:"rgba(255,0,0,0.3)",maskGapWidth:.3,wait:0,abortThreshold:0,abort:function(){},minRotation:-Math.PI/2,maxRotation:Math.PI/2,rotationSteps:0,shuffle:!0,rotateRatio:.1,shape:"circle",ellipticity:.65,classes:null,hover:null,click:null},e)for(g in e)g in f&&(f[g]=e[g]);if("function"!=typeof f.weightFactor&&(h=f.weightFactor,f.weightFactor=function(a){return a*h}),"function"!=typeof f.shape)switch(f.shape){case"circle":default:f.shape="circle";break;case"cardioid":f.shape=function(a){return 1-Math.sin(a)};break;case"diamond":f.shape=function(a){var b=a%(2*Math.PI/4);return 1/(Math.cos(b)+Math.sin(b))};break;case"square":f.shape=function(a){return Math.min(1/Math.abs(Math.cos(a)),1/Math.abs(Math.sin(a)))};break;case"triangle-forward":f.shape=function(a){var b=a%(2*Math.PI/3);return 1/(Math.cos(b)+Math.sqrt(3)*Math.sin(b))};break;case"triangle":case"triangle-upright":f.shape=function(a){var b=(a+3*Math.PI/2)%(2*Math.PI/3);return 1/(Math.cos(b)+Math.sqrt(3)*Math.sin(b))};break;case"pentagon":f.shape=function(a){var b=(a+.955)%(2*Math.PI/5);return 1/(Math.cos(b)+.726543*Math.sin(b))};break;case"star":f.shape=function(a){var b=(a+.955)%(2*Math.PI/10);return(a+.955)%(2*Math.PI/5)-2*Math.PI/10>=0?1/(Math.cos(2*Math.PI/10-b)+3.07768*Math.sin(2*Math.PI/10-b)):1/(Math.cos(b)+3.07768*Math.sin(b))}}switch(f.gridSize=Math.max(Math.floor(f.gridSize),4),i=f.gridSize,j=i-f.maskGapWidth,k=Math.abs(f.maxRotation-f.minRotation),l=Math.abs(Math.floor(f.rotationSteps)),m=Math.min(f.maxRotation,f.minRotation),f.color){case"random-dark":t=function(){return u(10,50)};break;case"random-light":t=function(){return u(50,90)};break;default:"function"==typeof f.color&&(t=f.color)}"function"==typeof f.fontWeight&&(v=f.fontWeight),w=null,"function"==typeof f.classes&&(w=f.classes),x=!1,y=[],A=function(a){var d,e,f,g,h,j,b=a.currentTarget,c=b.getBoundingClientRect();return a.touches?(d=a.touches[0].clientX,e=a.touches[0].clientY):(d=a.clientX,e=a.clientY),f=d-c.left,g=e-c.top,h=Math.floor(f*(b.width/c.width||1)/i),j=Math.floor(g*(b.height/c.height||1)/i),y[h][j]},B=function(a){var b=A(a);if(z!==b)return z=b,b?(f.hover(b.item,b.dimension,a),void 0):(f.hover(void 0,void 0,a),void 0)},C=function(a){var b=A(a);b&&(f.click(b.item,b.dimension,a),a.preventDefault())},D=[],E=function(a){var b,c,d,e;if(D[a])return D[a];for(b=8*a,c=b,d=[],0===a&&d.push([q[0],q[1],0]);c--;)e=1,"circle"!==f.shape&&(e=f.shape(2*(c/b)*Math.PI)),d.push([q[0]+a*e*Math.cos(2*(-c/b)*Math.PI),q[1]+a*e*Math.sin(2*(-c/b)*Math.PI)*f.ellipticity,2*(c/b)*Math.PI]);return D[a]=d,d},F=function(){return f.abortThreshold>0&&(new Date).getTime()-s>f.abortThreshold},G=function(){return 0===f.rotateRatio?0:Math.random()>f.rotateRatio?0:0===k?m:l>0?m+Math.floor(Math.random()*l)*k/(l-1):m+Math.random()*k},H=function(a,b,d){var h,j,k,l,m,n,o,p,q,r,s,t,u,w,x,y,z,A,C,D,E,B,G,e=!1,g=f.weightFactor(b);if(g<=f.minSize)return!1;if(h=1,c>g&&(h=function(){for(var a=2;c>a*g;)a+=2;return a}()),j=v?v(a,b,g):f.fontWeight,k=document.createElement("canvas"),l=k.getContext("2d",{willReadFrequently:!0}),l.font=j+" "+(g*h).toString(10)+"px "+f.fontFamily,m=l.measureText(a).width/h,n=Math.max(g*h,l.measureText("m").width,l.measureText("Ｗ").width)/h,o=m+2*n,p=3*n,q=Math.ceil(o/i),r=Math.ceil(p/i),o=q*i,p=r*i,s=-m/2,t=.4*-n,u=Math.ceil((o*Math.abs(Math.sin(d))+p*Math.abs(Math.cos(d)))/i),w=Math.ceil((o*Math.abs(Math.cos(d))+p*Math.abs(Math.sin(d)))/i),x=w*i,y=u*i,k.setAttribute("width",x),k.setAttribute("height",y),e&&(document.body.appendChild(k),l.save()),l.scale(1/h,1/h),l.translate(x*h/2,y*h/2),l.rotate(-d),l.font=j+" "+(g*h).toString(10)+"px "+f.fontFamily,l.fillStyle="#000",l.textBaseline="middle",l.fillText(a,s*h,(t+.5*g)*h),z=l.getImageData(0,0,x,y).data,F())return!1;for(e&&(l.strokeRect(s*h,t,m*h,n*h),l.restore()),A=[],B=w,G=[u/2,w/2,u/2,w/2];B--;)for(C=u;C--;){E=i;a:{for(;E--;)for(D=i;D--;)if(z[4*((C*i+E)*x+(B*i+D))+3]){A.push([B,C]),B<G[3]&&(G[3]=B),B>G[1]&&(G[1]=B),C<G[0]&&(G[0]=C),C>G[2]&&(G[2]=C),e&&(l.fillStyle="rgba(255, 0, 0, 0.5)",l.fillRect(B*i,C*i,i-.5,i-.5));break a}e&&(l.fillStyle="rgba(0, 0, 255, 0.5)",l.fillRect(B*i,C*i,i-.5,i-.5))}}return e&&(l.fillStyle="rgba(0, 255, 0, 0.5)",l.fillRect(G[3]*i,G[0]*i,(G[1]-G[3]+1)*i,(G[2]-G[0]+1)*i)),{mu:h,occupied:A,bounds:G,gw:w,gh:u,fillTextOffsetX:s,fillTextOffsetY:t,fillTextWidth:m,fillTextHeight:n,fontSize:g}},I=function(a,b,c,d,e){for(var h,i,g=e.length;g--;)if(h=a+e[g][0],i=b+e[g][1],h>=o||i>=p||0>h||0>i){if(!f.drawOutOfBound)return!1}else if(!n[h][i])return!1;return!0},J=function(b,c,d,e,g,h,j,k,l){var n,o,p,q,r,m=d.fontSize;n=t?t(e,g,m,h,j):f.color,o=v?v(e,g,m):f.fontWeight,p=w?w(e,g,m):f.classes,r=d.bounds,q={x:(b+r[3])*i,y:(c+r[0])*i,w:(r[1]-r[3]+1)*i,h:(r[2]-r[0]+1)*i},a.forEach(function(a){var g,h,j,q,r,s,t;if(a.getContext)g=a.getContext("2d"),h=d.mu,g.save(),g.scale(1/h,1/h),g.font=o+" "+(m*h).toString(10)+"px "+f.fontFamily,g.fillStyle=n,g.translate((b+d.gw/2)*i*h,(c+d.gh/2)*i*h),0!==k&&g.rotate(-k),g.textBaseline="middle",g.fillText(e,d.fillTextOffsetX*h,(d.fillTextOffsetY+.5*m)*h),g.restore();else{j=document.createElement("span"),q="",q="rotate("+180*(-k/Math.PI)+"deg) ",1!==d.mu&&(q+="translateX(-"+d.fillTextWidth/4+"px) "+"scale("+1/d.mu+")"),r={position:"absolute",display:"block",font:o+" "+m*d.mu+"px "+f.fontFamily,left:(b+d.gw/2)*i+d.fillTextOffsetX+"px",top:(c+d.gh/2)*i+d.fillTextOffsetY+"px",width:d.fillTextWidth+"px",height:d.fillTextHeight+"px",lineHeight:m+"px",whiteSpace:"nowrap",transform:q,webkitTransform:q,msTransform:q,transformOrigin:"50% 40%",webkitTransformOrigin:"50% 40%",msTransformOrigin:"50% 40%"},n&&(r.color=n),j.textContent=e;for(s in r)j.style[s]=r[s];if(l)for(t in l)j.setAttribute(t,l[t]);p&&(j.className+=p),a.appendChild(j)}})},K=function(b,c,d,e,f){if(!(b>=o||c>=p||0>b||0>c)){if(n[b][c]=!1,d){var g=a[0].getContext("2d");g.fillRect(b*i,c*i,j,j)}x&&(y[b][c]={item:f,dimension:e})}},L=function(b,c,d,e,g,h){var l,m,n,q,r,s,j=g.occupied,k=f.drawMask;for(k&&(l=a[0].getContext("2d"),l.save(),l.fillStyle=f.maskColor),x&&(n=g.bounds,m={x:(b+n[3])*i,y:(c+n[0])*i,w:(n[1]-n[3]+1)*i,h:(n[2]-n[0]+1)*i}),q=j.length;q--;)r=b+j[q][0],s=c+j[q][1],r>=o||s>=p||0>r||0>s||K(r,s,k,m,h);k&&l.restore()},M=function jb(a){var b,c,e,g,h,i,j,k,l,m;if(Array.isArray(a)?(b=a[0],c=a[1]):(b=a.word,c=a.weight,e=a.attributes),g=G(),h=H(b,c,g),!h)return!1;if(F())return!1;if(!f.drawOutOfBound&&(i=h.bounds,i[1]-i[3]+1>o||i[2]-i[0]+1>p))return!1;for(j=r+1,k=function(d){var f=Math.floor(d[0]-h.gw/2),i=Math.floor(d[1]-h.gh/2),k=h.gw,l=h.gh;return I(f,i,k,l,h.occupied)?(J(f,i,h,b,c,r-j,d[2],g,e),L(f,i,k,l,h,a),!0):!1};j--;)if(l=E(r-j),f.shuffle&&(l=[].concat(l),d(l)),m=l.some(k))return!0;return f.shrinkToFit?(Array.isArray(a)?a[1]=3*a[1]/4:a.weight=3*a.weight/4,jb(a)):!1},N=function(b,c,d){return c?!a.some(function(a){var c=new CustomEvent(b,{detail:d||{}});return!a.dispatchEvent(c)},this):(a.forEach(function(a){var c=new CustomEvent(b,{detail:d||{}});a.dispatchEvent(c)},this),void 0)},O=function(){var c,d,e,g,h,j,k,l,m,t,u,v,w,A,D,b=a[0];if(b.getContext?(o=Math.ceil(b.width/i),p=Math.ceil(b.height/i)):(c=b.getBoundingClientRect(),o=Math.ceil(c.width/i),p=Math.ceil(c.height/i)),N("wordcloudstart",!0)){if(q=f.origin?[f.origin[0]/i,f.origin[1]/i]:[o/2,p/2],r=Math.floor(Math.sqrt(o*o+p*p)),n=[],!b.getContext||f.clearCanvas)for(a.forEach(function(a){if(a.getContext){var b=a.getContext("2d");b.fillStyle=f.backgroundColor,b.clearRect(0,0,o*(i+1),p*(i+1)),b.fillRect(0,0,o*(i+1),p*(i+1))}else a.textContent="",a.style.backgroundColor=f.backgroundColor,a.style.position="relative"}),d=o;d--;)for(n[d]=[],e=p;e--;)n[d][e]=!0;else{for(h=document.createElement("canvas").getContext("2d"),h.fillStyle=f.backgroundColor,h.fillRect(0,0,1,1),j=h.getImageData(0,0,1,1).data,k=b.getContext("2d").getImageData(0,0,o*i,p*i).data,d=o;d--;)for(n[d]=[],e=p;e--;){m=i;a:for(;m--;)for(l=i;l--;)for(g=4;g--;)if(k[4*((e*i+m)*o*i+(d*i+l))+g]!==j[g]){n[d][e]=!1;break a}n[d][e]!==!1&&(n[d][e]=!0)}k=h=j=void 0}if(f.hover||f.click){for(x=!0,d=o+1;d--;)y[d]=[];f.hover&&b.addEventListener("mousemove",B),f.click&&(b.addEventListener("click",C),b.style.webkitTapHighlightColor="rgba(0, 0, 0, 0)"),b.addEventListener("wordcloudstart",function E(){b.removeEventListener("wordcloudstart",E),b.removeEventListener("mousemove",B),b.removeEventListener("click",C),z=void 0})}g=0,0!==f.wait?(t=window.setTimeout,u=window.clearTimeout):(t=window.setImmediate,u=window.clearImmediate),v=function(b,c){a.forEach(function(a){a.addEventListener(b,c)},this)},w=function(b,c){a.forEach(function(a){a.removeEventListener(b,c)},this)},A=function I(){w("wordcloudstart",I),u(D)},v("wordcloudstart",A),D=t(function J(){var a,b;return g>=f.list.length?(u(D),N("wordcloudstop",!1),w("wordcloudstart",A),void 0):(s=(new Date).getTime(),a=M(f.list[g]),b=!N("wordclouddrawn",!0,{item:f.list[g],drawn:a}),F()||b?(u(D),f.abort(),N("wordcloudabort",!1),N("wordcloudstop",!1),w("wordcloudstart",A),void 0):(g++,D=t(J,f.wait),void 0))},f.wait)}},O()}};e.isSupported=b,e.minFontSize=c,"function"==typeof define&&define.amd?(a.WordCloud=e,define("wordcloud",[],function(){return e})):"undefined"!=typeof module&&module.exports?module.exports=e:a.WordCloud=e}(this);

jQuery(document).ready(function($) {
    if($(".tag-view-switch").hasClass("done")) return;
    
    $(".tag-view-switch").on("click", "button", function() {
        $(".tag-view-switch button").removeClass("active");
        $(this).addClass("active");
        
        $(".tags-content").hide();
        $("#" + $(this).data("togget")).fadeIn();
    });
    
    var tag_base = mk_theme_api.home_url + "/?tag=";
    var h = $("#tag-cloud-tooltip"), tagCloud = $('#tag-cloud-canvas');
    
    $(h).on("mouseover", function(event) {
        $(this).hide();
    });
    
    
    for(var i=0; i<lists.length; i++) {
        $("#tag-cloud-ball").append('<a href="' + tag_base + encodeURIComponent(lists[i][0]) + '">' + lists[i][0] + ' (' + lists[i][1] + ')</a>');
    }
    
    new WordCloud(tagCloud[0], { 
        list: lists,
        drawOutOfBound: false,
        weightFactor: 30,
        gridSize: 0,
        wait: 50,
        shape: "triangle",
        backgroundColor: "rgba(255,255,255,0.35)",
        rotateRatio: 1,
        minRotation: -30 * Math.PI / 180,
        maxRotation: 30 * Math.PI / 180,
        hover: function n(t, e, o) {
            t ? (h.html('<div class="tag-tooltip-title">标签：' + t[0] + '</div><div class="tag-tooltip-counts">' + 
            '一共出现<span>' + t[1] + ' </span> 次</div>' + 
            '<div class="tag-tooltip-tips">点击查看「<span>' + t[0] + "</span>」的相关文章</div>"), h.css({
                display: "block",
                left: o.clientX + 15 + "px",
                top: o.clientY + 15 + "px"
            }), tagCloud.css("cursor","pointer")) : (h.css("display", "none"), tagCloud.css("cursor","default"));
        },
        click: function n(t) {
            t && (location.href = tag_base + encodeURIComponent(t[0]));
        }
    });
    
    $(".tag-view-switch").addClass("done");
});
